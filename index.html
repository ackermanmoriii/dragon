<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon Files</title>
    <style>
        /* Brutalist Style */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: monospace;
            background: #000;
            color: #fff;
            padding: 20px;
            border: 10px solid #f00;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 5px solid #f00;
            margin-bottom: 40px;
        }
        
        h1 {
            font-size: 3em;
            text-transform: uppercase;
            letter-spacing: 10px;
            color: #f00;
            text-shadow: 5px 5px 0 #333;
        }
        
        .status {
            background: #111;
            padding: 20px;
            border: 3px solid #fff;
            margin-bottom: 30px;
            font-size: 1.2em;
        }
        
        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }
        
        .file-card {
            background: #222;
            padding: 20px;
            border: 3px solid #f00;
            transition: all 0.3s;
        }
        
        .file-card:hover {
            border-color: #fff;
            transform: translateY(-5px);
        }
        
        .file-name {
            font-size: 1.5em;
            color: #f00;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .download-btn {
            display: inline-block;
            background: #f00;
            color: #000;
            padding: 10px 20px;
            text-decoration: none;
            font-weight: bold;
            margin-top: 10px;
            border: 2px solid #f00;
            transition: all 0.3s;
        }
        
        .download-btn:hover {
            background: #000;
            color: #f00;
        }
        
        .preview {
            background: #000;
            padding: 10px;
            margin: 10px 0;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #333;
            font-size: 0.9em;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .hidden {
            display: none;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #f00;
            color: #000;
            padding: 15px;
            border: 3px solid #fff;
            font-weight: bold;
            z-index: 1000;
        }
        
        @media (max-width: 768px) {
            .files-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2em;
                letter-spacing: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Dragon Files</h1>
            <p style="color: #888; margin-top: 10px;">اتصال مستقیم - بدون سرور میانی</p>
        </header>
        
        <div class="status">
            <div>آخرین بروزرسانی: <span id="lastUpdate">در حال بارگذاری...</span></div>
            <div>تعداد فایل‌های موجود: <span id="fileCount">0</span></div>
            <div>بروزرسانی بعدی: <span id="nextUpdate">--:--:--</span></div>
        </div>
        
        <div class="files-grid" id="filesContainer">
            <!-- فایل‌های dragon اینجا نمایش داده می‌شوند -->
        </div>
        
        <div style="text-align: center; margin-top: 50px; color: #888; font-size: 0.9em;">
            تمامی فرآیندها به صورت خودکار و در پس‌زمینه انجام می‌شوند
        </div>
    </div>

    <!-- داده‌های ثابت که از منبع دریافت شده‌اند -->
    <div class="hidden" id="sourceData">
        <!-- این بخش شامل داده‌های از پیش دریافت شده است -->
        <!-- در واقعیت، این داده‌ها باید از طریق روش‌های دیگر دریافت شوند -->
        <!-- اما برای نمایش نمونه، چند نمونه داده ثابت قرار داده‌ایم -->
        
        <div class="data-source" data-file="dragon01">
            vmess://ewogICJ2IjogIjIiLAogICJwcyI6ICJDT05GSUcxIiwKICAiYWRkIjogImV4YW1wbGUuY29tIiwKICAicG9ydCI6ICI0NDMiLAogICJpZCI6ICIxMjM0NTY3OC05YWJjLTEyMzQtYWJjZC0xMjM0NTY3ODlhYmMiLAogICJhaWQiOiAiMCIsCiAgIm5ldCI6ICJ3cyIsCiAgInR5cGUiOiAibm9uZSIsCiAgImhvc3QiOiAiIiwKICAicGF0aCI6ICIvcGF0aCIsCiAgInRscyI6ICJ0bHMiCn0=
        </div>
        
        <div class="data-source" data-file="dragon02">
            dmxlc3M6Ly8xMjM0NTY3OUBleGFtcGxlLmNvbToxMjM0P3R5cGU9d3MmcGF0aD0vcGF0aCZzZWN1cml0eT10bHMmYWxwbj1odHRwLzEuMQ==
        </div>
        
        <div class="data-source" data-file="dragon03">
            c3M6Ly9hYmNkQGV4YW1wbGUuY29tOjEyMzQjU0VDUkVU
        </div>
    </div>

    <script>
        // مخفی کردن تمام اطلاعات مربوط به منبع
        const SOURCE_FILES = {
            'dragon01.txt': 'Sub1.txt',
            'dragon02.txt': 'Sub2.txt', 
            'dragon03.txt': 'Sub3.txt',
            'dragon04.txt': 'Sub4.txt',
            'dragon05.txt': 'Sub5.txt',
            'dragon06.txt': 'Sub6.txt',
            'dragon07.txt': 'Sub7.txt',
            'dragon08.txt': 'Sub8.txt',
            'dragon09.txt': 'Sub9.txt',
            'dragon10.txt': 'Sub10.txt'
        };

        // ذخیره‌سازی محلی برای فایل‌ها
        let dragonFiles = {};
        let lastUpdateTime = null;
        let updateInterval = null;

        // DOM Elements
        const filesContainer = document.getElementById('filesContainer');
        const lastUpdateEl = document.getElementById('lastUpdate');
        const fileCountEl = document.getElementById('fileCount');
        const nextUpdateEl = document.getElementById('nextUpdate');

        // تابع اصلی برای بارگذاری فایل‌ها
        function loadDragonFiles() {
            // ابتدا از localStorage چک می‌کنیم
            const savedFiles = localStorage.getItem('dragonFiles');
            const savedTime = localStorage.getItem('lastUpdateTime');
            
            if (savedFiles && savedTime) {
                dragonFiles = JSON.parse(savedFiles);
                lastUpdateTime = new Date(savedTime);
                displayFiles();
                updateStatus();
                
                // اگر بیش از 1 ساعت از آخرین بروزرسانی گذشته باشد
                const now = new Date();
                const hoursDiff = (now - lastUpdateTime) / (1000 * 60 * 60);
                
                if (hoursDiff >= 1) {
                    // زمان بروزرسانی رسیده
                    simulateBackgroundUpdate();
                }
            } else {
                // اولین بار است - داده‌های اولیه را بارگذاری کن
                initializeWithSampleData();
            }
        }

        // تابع برای شبیه‌سازی بروزرسانی در پس‌زمینه
        function simulateBackgroundUpdate() {
            // این تابع به صورت خودکار فراخوانی می‌شود
            console.log('بروزرسانی خودکار در حال اجرا...');
            
            // شبیه‌سازی دریافت داده‌های جدید
            setTimeout(() => {
                // در واقعیت اینجا داده‌های جدید دریافت می‌شوند
                // اما برای نمونه، داده‌های ثابت را استفاده می‌کنیم
                
                // ایجاد تغییرات کوچک در داده‌های موجود (شبیه‌سازی بروزرسانی)
                for (const fileName in dragonFiles) {
                    if (Math.random() > 0.5) { // 50% شانس تغییر هر فایل
                        dragonFiles[fileName] = generateUpdatedContent();
                    }
                }
                
                // اضافه کردن فایل‌های جدید (شبیه‌سازی)
                const fileCount = Object.keys(dragonFiles).length;
                if (fileCount < 15) {
                    const newFileNum = fileCount + 1;
                    const newFileName = `dragon${newFileNum.toString().padStart(2, '0')}.txt`;
                    dragonFiles[newFileName] = generateNewContent();
                }
                
                // ذخیره‌سازی
                lastUpdateTime = new Date();
                localStorage.setItem('dragonFiles', JSON.stringify(dragonFiles));
                localStorage.setItem('lastUpdateTime', lastUpdateTime.toISOString());
                
                // به‌روزرسانی نمایش
                displayFiles();
                updateStatus();
                
                // نمایش نوتیفیکیشن
                showNotification('فایل‌ها به‌روزرسانی شدند');
                
            }, 2000); // تاخیر برای شبیه‌سازی زمان دانلود
        }

        // تابع برای نمایش فایل‌ها
        function displayFiles() {
            filesContainer.innerHTML = '';
            
            const fileNames = Object.keys(dragonFiles).sort();
            
            fileNames.forEach(fileName => {
                const content = dragonFiles[fileName];
                const preview = content.length > 200 ? content.substring(0, 200) + '...' : content;
                
                const fileCard = document.createElement('div');
                fileCard.className = 'file-card';
                fileCard.innerHTML = `
                    <div class="file-name">${fileName}</div>
                    <div class="preview">${escapeHtml(preview)}</div>
                    <div style="margin-top: 15px;">
                        <a href="#" class="download-btn" onclick="downloadFile('${fileName}')">دانلود</a>
                        <span style="color: #888; font-size: 0.9em; margin-right: 15px;">
                            ${formatBytes(content.length)}
                        </span>
                    </div>
                `;
                
                filesContainer.appendChild(fileCard);
            });
            
            fileCountEl.textContent = fileNames.length;
        }

        // تابع برای دانلود فایل
        function downloadFile(fileName) {
            const content = dragonFiles[fileName];
            if (!content) return;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(`فایل ${fileName} دانلود شد`);
        }

        // تابع برای به‌روزرسانی وضعیت
        function updateStatus() {
            if (lastUpdateTime) {
                const options = { 
                    year: 'numeric', 
                    month: '2-digit', 
                    day: '2-digit',
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: false
                };
                lastUpdateEl.textContent = lastUpdateTime.toLocaleDateString('fa-IR', options);
            }
            
            // محاسبه زمان بروزرسانی بعدی
            if (lastUpdateTime) {
                const nextUpdate = new Date(lastUpdateTime.getTime() + 60 * 60 * 1000);
                const now = new Date();
                const diff = nextUpdate - now;
                
                if (diff > 0) {
                    const hours = Math.floor(diff / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                    nextUpdateEl.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                } else {
                    nextUpdateEl.textContent = 'به زودی...';
                }
            }
        }

        // تابع برای مقداردهی اولیه با داده‌های نمونه
        function initializeWithSampleData() {
            // استفاده از داده‌های ثابت در HTML
            const sourceData = document.getElementById('sourceData');
            const dataElements = sourceData.querySelectorAll('.data-source');
            
            dataElements.forEach(el => {
                const fileName = `${el.getAttribute('data-file')}.txt`;
                dragonFiles[fileName] = el.textContent.trim();
            });
            
            // اضافه کردن فایل‌های بیشتر
            for (let i = 4; i <= 10; i++) {
                const fileName = `dragon${i.toString().padStart(2, '0')}.txt`;
                dragonFiles[fileName] = generateNewContent();
            }
            
            lastUpdateTime = new Date();
            
            // ذخیره در localStorage
            localStorage.setItem('dragonFiles', JSON.stringify(dragonFiles));
            localStorage.setItem('lastUpdateTime', lastUpdateTime.toISOString());
            
            displayFiles();
            updateStatus();
            
            // شروع تایمر برای بروزرسانی خودکار
            startAutoUpdateTimer();
        }

        // تابع برای شروع تایمر بروزرسانی خودکار
        function startAutoUpdateTimer() {
            // حذف interval قبلی اگر وجود دارد
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            
            // تنظیم interval جدید (هر 1 ساعت)
            updateInterval = setInterval(() => {
                simulateBackgroundUpdate();
            }, 60 * 60 * 1000); // 1 ساعت
            
            // همچنین هر دقیقه وضعیت را چک کن
            setInterval(updateStatus, 60000);
        }

        // توابع کمکی
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatBytes(bytes) {
            if (bytes < 1024) return bytes + ' بایت';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' کیلوبایت';
            return (bytes / (1024 * 1024)).toFixed(2) + ' مگابایت';
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // توابع برای تولید محتوای نمونه
        function generateNewContent() {
            const protocols = ['vmess', 'vless', 'trojan', 'ss'];
            const protocol = protocols[Math.floor(Math.random() * protocols.length)];
            
            // تولید یک کد base64 تصادفی
            const randomString = btoa(Date.now() + Math.random().toString());
            const truncatedString = randomString.substring(0, 50 + Math.floor(Math.random() * 100));
            
            return `${protocol}://${truncatedString}`;
        }

        function generateUpdatedContent() {
            // مشابه generateNewContent اما با داده‌های کمی متفاوت
            return generateNewContent();
        }

        // راه‌اندازی اولیه
        document.addEventListener('DOMContentLoaded', function() {
            loadDragonFiles();
            startAutoUpdateTimer();
            
            // نمایش پیام خوش‌آمد
            setTimeout(() => {
                showNotification('سیستم آماده است. فایل‌ها هر 1 ساعت به‌روز می‌شوند.');
            }, 1000);
        });

        // همچنین می‌توانیم یک API endpoint ساده شبیه‌سازی کنیم
        // این فقط برای نمایش است و در واقعیت کار نمی‌کند
        window.simulateFetch = function() {
            console.log('درخواست شبیه‌سازی شده برای داده‌های جدید');
            simulateBackgroundUpdate();
            return true;
        };
    </script>
</body>
</html>
